<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Ara's Classes</title>
        <!-- Vue.js CDN for reactive framework support -->
        <script src="https://cdn.jsdelivr.net/npm/vue@2.7.16/dist/vue.js"></script>
        <!-- Font Awesome Icons -->
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css"
        />
        <!-- CSS Link -->
        <link rel="stylesheet" href="css/frontend.css" />
    </head>

    <body>
        <div id="app" class="container">
            <!-- Header Section -->
            <header>
                <a href="#app" class="logo">
                    <span class="fas fa-school"></span>
                </a>
                <h1 v-text="sitename"></h1>
                <ul class="navbar">
                    <li><a href="#app">Home</a></li>
                    <li><a href="#aboutus">About Us</a></li>
                </ul>
                <button v-on:click="toggleCheckout">
                    {{ cartItemCount }} <span class="fas fa-cart-plus"></span> Checkout
                </button>
            </header>

            <!-- Main Content Area -->
            <main>
                <!-- Class Display Section -->
                <div v-if="showClass">
                    <div class="search-sort">
                        <h3>Search:</h3>
                        <input
                            type="text"
                            placeholder="Search by title..."
                            class="search-bar"
                            v-model="searchQuery"
                            v-on:input="searchClasses"
                        />
                        <h3>Sort:</h3>
                        <div class="sort-controls">
                            <button v-on:click="sortBy('title', 'asc')">Sort by Name (A-Z)</button>
                            <button v-on:click="sortBy('title', 'desc')">Sort by Name (Z-A)</button>
                            <button v-on:click="sortBy('availableInventory', 'asc')">
                                Sort by Availability (Low-High)
                            </button>
                            <button v-on:click="sortBy('availableInventory', 'desc')">
                                Sort by Availability (High-Low)
                            </button>
                            <button v-on:click="sortBy('price', 'asc')">
                                Sort by Price (Low-High)
                            </button>
                            <button v-on:click="sortBy('price', 'desc')">
                                Sort by Price (High-Low)
                            </button>

                            <button v-on:click="resetSort">Reset View</button>
                        </div>
                    </div>

                    <div class="content">
                        <div v-for="Class in filteredClasses" :key="Class._id" class="product-card">
                            <figure>
                                <img v-bind:src="getLink(Class.image)" alt="Class Image" />
                            </figure>
                            <h2 v-text="Class.title"></h2>
                            <p v-html="Class.description"></p>
                            <p class="price">Price: {{ Class.price }}</p>
                            <button v-on:click="addToCart(Class)" v-if="canAddToCart(Class)">
                                Add to cart
                            </button>
                            <button disabled v-else>Out of Stock</button>
                            <span
                                v-if="Class.availableInventory === cartCount(Class._id)"
                                class="all-out"
                                >All out!</span
                            >
                            <span
                                v-else-if="Class.availableInventory - cartCount(Class._id) < 5"
                                class="items-left"
                                >Only {{ Class.availableInventory - cartCount(Class._id) }}
                                left!</span
                            >
                            <span v-else>Buy now!</span>
                        </div>
                    </div>
                </div>

                <!-- Checkout Section -->
                <div v-else class="checkout-container">
                    <div class="cart-section">
                        <h3>Your Cart</h3>
                        <div v-if="cart.length === 0">Your cart is empty.</div>
                        <ul>
                            <li v-for="item in uniqueCartItems" :key="item._id">
                                {{ item.title }} - Price: {{ item.price }} (Count: {{ }})
                                <button v-on:click="removeFromCart(item._id)">Remove</button>
                            </li>
                        </ul>
                    </div>

                    <div class="order-form">
                        <h2>Checkout</h2>
                        <div class="form-group">
                            <label for="firstName"><strong>First Name:</strong></label>
                            <input id="firstName" v-model.trim="order.firstName" type="text" />
                        </div>
                        <div class="form-group">
                            <label for="lastName"><strong>Last Name:</strong></label>
                            <input id="lastName" v-model.trim="order.lastName" type="text" />
                        </div>
                        <div class="form-group">
                            <label for="address"><strong>Address:</strong></label>
                            <input id="address" v-model="order.address" type="text" />
                        </div>
                        <div class="form-group">
                            <label for="phone"><strong>Phone Number:</strong></label>
                            <input id="phone" v-model="order.phone" type="number" />
                        </div>
                        <div class="form-group">
                            <label for="state"><strong>State:</strong></label>
                            <select id="state" v-model="order.state" class="form-control">
                                <option disabled value="">Select State</option>
                                <option v-for="(state, key) in states" :value="key">
                                    {{ state }}
                                </option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="zip"><strong>Zip:</strong></label>
                            <input id="zip" v-model.number="order.zip" type="number" />
                        </div>
                        <div class="form-group">
                            <div class="checkbox-group">
                                <input
                                    type="checkbox"
                                    id="gift"
                                    value="true"
                                    v-model="order.gift"
                                />
                                <label for="gift">Ship as a Gift?</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <strong>Delivery Method:</strong>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input
                                        type="radio"
                                        id="home"
                                        value="Home"
                                        v-model="order.method"
                                    />
                                    <label for="home">Home</label>
                                </div>
                                <div class="radio-option">
                                    <input
                                        type="radio"
                                        id="business"
                                        value="Business"
                                        v-model="order.method"
                                    />
                                    <label for="business">Business</label>
                                </div>
                            </div>
                        </div>

                        <h2>Order Summary</h2>
                        <div class="order-summary">
                            <p>First Name: {{ order.firstName }}</p>
                            <p>Last Name: {{ order.lastName }}</p>
                            <p>Address: {{ order.address }}</p>
                            <p>Phone: {{ order.phone }}</p>
                            <p>State: {{ order.state }}</p>
                            <p>Zip: {{ order.zip }}</p>
                            <p>Gift: {{ order.gift ? "Yes" : "No" }}</p>
                            <p>Delivery: {{ order.method }}</p>
                        </div>

                        <button v-on:click="submitForm" class="submit-button">Place Order</button>
                    </div>
                </div>
            </main>

            <!-- Footer Section -->
            <footer id="aboutus">
                <div class="footer-container">
                    <div class="footer-about">
                        <h4>About Us</h4>
                        <p>
                            At Ara's Classes, we offer a variety of engaging lessons tailored to
                            your interests and skills. Join us to unlock your potential!
                        </p>
                    </div>
                    <div class="footer-links">
                        <h4>Quick Links</h4>
                        <ul>
                            <li><a href="#app">Home</a></li>
                            <li><a href="#aboutus">About Us</a></li>
                        </ul>
                    </div>
                    <div class="footer-contact">
                        <h4>Contact Us</h4>
                        <p>Email: arasclasses@corp.co</p>
                        <p>Phone: +971 50 1234567</p>
                        <p>Address: 123 Learning Lane, Knowledge Village, EDU</p>
                    </div>
                </div>
                <div class="footer-bottom">
                    <p>&copy; 2024 Ara's Classes. All Rights Reserved.</p>
                </div>
            </footer>
        </div>
        <script>
            let webstore = new Vue({
                el: "#app",
                data: {
                    sitename: "Ara's Classes",
                    classes: [],
                    cart: [],
                    currentSort: null,
                    sortOrder: null,
                    showClass: true,
                    order: {
                        firstName: "",
                        lastName: "",
                        address: "",
                        phone: "",
                        zip: "",
                        state: "",
                        method: "Home",
                        gift: false,
                    },
                    states: {
                        AD: "Abu Dhabi",
                        DU: "Dubai",
                        SH: "Sharjah",
                        AJ: "Ajman",
                        FJ: "Fujairah",
                        RK: "Ras Al Khaimah",
                        UQ: "Umm Al Quwain",
                    },
                    searchQuery: "",
                },
                created() {
                    this.getLessons();
                },
                methods: {
                    getLessons() {
                        fetch("https://aras-classes.onrender.com/collection/Lessons", {
                            method: "GET",
                            headers: {
                                "Content-Type": "application/json",
                            },
                        })
                            .then((response) => response.json())
                            .then((responseJSON) => {
                                this.classes = responseJSON.map((item) => ({
                                    ...item,
                                    _id: String(item._id),
                                }));
                            })
                            .catch((error) => {
                                console.error("Error fetching Classes:", error);
                            });
                    },
                    sortBy(key, order) {
                        this.currentSort = key;
                        this.sortOrder = order;

                        // Sort logic
                        this.classes.sort((a, b) => {
                            const valA = a[key];
                            const valB = b[key];

                            if (order === "asc") return valA > valB ? 1 : -1;
                            if (order === "desc") return valA < valB ? 1 : -1;
                            return 0;
                        });
                    },
                    resetSort() {
                        this.currentSort = null;
                        this.sortOrder = null;
                        this.getLessons(); // Reset to original order
                    },
                    searchClasses() {
                        const query = this.searchQuery.trim();

                        if (query === "") {
                            this.getLessons(); // Fetch all Classes if search query is empty
                            return;
                        }

                        // Fetch search results from the backend
                        fetch(`https://aras-classes.onrender.com/search/Lessons?query=${query}`, {
                            method: "GET",
                            headers: {
                                "Content-Type": "application/json",
                            },
                        })
                            .then((response) => response.json())
                            .then((data) => {
                                this.classes = data.map((item) => ({
                                    ...item,
                                    _id: String(item._id),
                                }));
                            })
                            .catch((error) => {
                                console.error("Error performing search:", error);
                            });
                    },
                    toggleCheckout() {
                        this.showClass = !this.showClass;
                    },
                    addToCart(Class) {
                        this.cart.push(Class);
                    },
                    removeFromCart(classId) {
                        this.cart = this.cart.filter((item) => item._id !== classId);
                    },
                    canAddToCart(Class) {
                        return Class.availableInventory > this.cartCount(Class._id);
                    },
                    cartCount(id) {
                        return this.cart.filter((item) => item._id === id).length;
                    },
                    getLink(image) {
                        return `https://aras-classes.onrender.com/${image}`;
                    },
                    submitForm() {
                        alert("Order placed successfully!");
                        this.cart = [];
                        this.order = {
                            firstName: "",
                            lastName: "",
                            address: "",
                            phone: "",
                            zip: "",
                            state: "",
                            method: "Home",
                            gift: false,
                        };
                        this.showClass = true;
                    },
                },
                computed: {
                    cartItemCount() {
                        return this.cart.length || 0;
                    },
                    uniqueCartItems() {
                        return [...new Set(this.cart.map((item) => item._id))].map((id) => {
                            return this.classes.find((classItem) => classItem._id === id);
                        });
                    },
                    filteredClasses() {
                        // Filter by search query
                        let filtered = this.classes.filter((Class) =>
                            Class.title.toLowerCase().includes(this.searchQuery.toLowerCase())
                        );

                        // Sort by selected criteria
                        if (this.currentSort) {
                            filtered.sort((a, b) => {
                                const valA = a[this.currentSort];
                                const valB = b[this.currentSort];

                                if (this.sortOrder === "asc") return valA > valB ? 1 : -1;
                                if (this.sortOrder === "desc") return valA < valB ? 1 : -1;
                                return 0;
                            });
                        }

                        return filtered;
                    },
                },
            });
        </script>
    </body>
</html>
